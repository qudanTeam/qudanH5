<html lang="en" style="font-size: 10px;">

<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>进度查询</title>
    <link rel="stylesheet" href="css/reset.css?v=20190103001">
    <script src="js/rem.js"></script>
    <link rel="stylesheet" href="css/common.css?v=20190104001">
    <link rel="stylesheet" href="css/progress.css?v=20190103001">
</head>

<body>
    <header id="header">
        <a class='icon-back'></a>
        <h1>进度查询</h1>
    </header>
    <div class="content prodetail-content">
        <!-- <div class="banner">
            <img src="" alt="">
        </div> -->
        <div class="prodetail-main">
            <h2 class="title">
                <span class="logo-wrap">
                    <img class="logo" src="images/icon-td.png" alt="">
                </span>
                <span class="product-name"></span>办卡进度
            </h2>
            <form action="" class="form-pro">
                <div class="input-grow">
                    <input type="text" placeholder="请输入真实姓名" class="realName">
                </div>
                <div class="input-grow">
                    <input type="number" placeholder="请输入申请人身份证" class="idNo">
                </div>
                <div class="input-grow input-grow-hasright input-grow-imgcode" style="display: none;">
                    <input type="text" placeholder="请输入图形验证码" class="imgCode">
                    <span class="btn-getcode"></span>
                </div>
                <div class="input-grow input-grow-hasright input-grow-msgcode" style="display: none;">
                    <input type="number" placeholder="请输入验证码" class="msgCode">
                    <span class="text-yellow btn-getcode">获取验证码</span>
                </div>
            </form>
            <div class="btn-wrap">
                <a class="btn linear-gradient-yellow btn-submit">查询办卡进度</a>
            </div>
        </div>
    </div>
    <input type="hidden" value="">
    <script src="js/config.js"></script>
    <script src="plugin/layer_mobile/layer.js"></script>
    <script src="js/common.js"></script>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script>
        // var bannerImg = document.querySelector('.prodetail-content img');
        var productLogo = document.querySelector('.logo');
        var productName = document.querySelector('.product-name');
        var imgCode = document.querySelector('.input-grow-imgcode');
        var msgCode = document.querySelector('.input-grow-msgcode');
        var btnSubmit = document.querySelector('.btn-submit');
        var isBankList = getQueryString('isBankList');
        var pid = getQueryString('pid');
        ajaxGet(IP + 'msqudan/api/product/' + pid, getLogo);//获取logo
        if (isBankList && isBankList == 1) {
            ajaxGet(IP + 'msqudan/api/bank/' + pid, getSimpleBank);//获取查询信息：从银行列表进来的传银行id，否则传商品id，并调用不同接口
        } else {
            ajaxGet(IP + 'msqudan/api/product/' + pid + '/simple', getSimple);//获取查询信息
        }
        btnSubmit.addEventListener("click", function () {
            console.log(getCookie('token'));
            console.log(getCookie('weblogic'));
            var realName = document.querySelector(".realName").value;
            var idNo = document.querySelector(".idNo").value;
            var imgCode = document.querySelector(".imgCode").value;
            var msgCode = document.querySelector(".msgCode").value;
            if (idNo == '') {
                layerMsg("请输入身份证号码");
                return false;
            }
            if (idNo != "") {
                // 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
                var reg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                if (reg.test(idNo) === false) {
                    layerMsg("身份证号码有误<br>请重新输入");
                    return false;
                }
            }
        })
        function getLogo(Data) {
            if (Data.code == 200) {
                var product = Data.data.detail.product;
                // bannerImg.setAttribute('src',product.progressQueryImg);
                productLogo.setAttribute('src', product.logo);
                productName.innerHTML = product.productName;
            }
        }
        function getSimpleBank(Data) {
            if (Data.code == 200) {
                //存储bankId，后面获取手机验证码或者提交查询的时候传给服务端
                document.querySelector("input[type='hidden']").value = Data.data.bank.bankId;
                if (Data.data.bank.needVerifyCode == 0) {//是否需要图形验证码 0-否，1-是
                    imgCode.style.display = 'none';
                } else {
                    imgCode.style.display = 'block';
                    imgCode.querySelector(".btn-getcode").innerHTML = '<img src=' + Data.data.bank.verifyCodeLink + '/>';

                }
                if (Data.data.bank.needMobileVerifyCode == 0) {//是否需要图形验证码 0-否，1-是
                    msgCode.style.display = 'none';
                } else {
                    msgCode.style.display = 'block';

                }

            }
        }
        function getSimple(Data) {
            if (Data.code == 200) {

                //存储bankId，后面获取手机验证码或者提交查询的时候传给服务端
                document.querySelector("input[type='hidden']").value = Data.data.simple.bankId;
                if (Data.data.simple.needVerifyCode == 0) {//是否需要图形验证码 0-否，1-是
                    imgCode.style.display = 'none';
                } else {
                    imgCode.style.display = 'block';
                    imgCode.querySelector(".btn-getcode").innerHTML = '<img src=' + Data.data.simple.verifyCodeLink + '/>';

                }
                if (Data.data.simple.needMobileVerifyCode == 0) {//是否需要图形验证码 0-否，1-是
                    msgCode.style.display = 'none';
                } else {
                    msgCode.style.display = 'block';

                }

            }
        }
        function ajaxGet(url, callback) {
            $.ajax({
                url: url,
                type: "GET",
                dataType: 'json',
                success: callback,
                error: function (e) {
                    layerMsg($.parseJSON(e.responseText).error.message);
                }
            })
        }
    </script>

</body>

</html>